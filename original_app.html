<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0C0C0C">
  <meta name="description" content="Property management dashboard for real estate professionals">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Realtor Dashboard">
  
  <title>Realtor Dashboard</title>
  
  <!-- PWA assets -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/svg+xml" href="/icons/icon-512x512.svg">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  
  <style>
    /* Critical CSS for initial load */
    :root {
      --color-primary: #CBA328;
      --color-primary-hover: #D6B040;
      --color-background: #0C0C0C;
      --color-card: #171717;
      --color-border: #333333;
      --color-text: #EEEEEE;
      --color-text-secondary: #AAAAAA;
      --color-text-tertiary: #777777;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --border-radius-sm: 8px;
      --border-radius-md: 12px;
      --border-radius-lg: 16px;
    }
    
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      background-color: var(--color-background);
      color: var(--color-text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    .app {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-md);
      border-bottom: 1px solid var(--color-border);
    }
    
    .app-title {
      margin: 0;
      font-size: 1.5rem;
      background: linear-gradient(to right, var(--color-primary), #E5C867);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .theme-toggle {
      background: none;
      border: none;
      color: var(--color-text);
      cursor: pointer;
      padding: var(--spacing-xs);
    }
    
    .app-content {
      flex: 1;
      overflow-y: auto;
      padding: var(--spacing-md);
    }
    
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      background-color: var(--color-card);
      padding: var(--spacing-sm) 0;
      border-top: 1px solid var(--color-border);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--color-text-tertiary);
      text-decoration: none;
      padding: var(--spacing-xs) 0;
    }
    
    .nav-item.active {
      color: var(--color-primary);
    }
    
    .nav-label {
      font-size: 0.75rem;
      margin-top: var(--spacing-xs);
    }
    
    .card {
      background-color: var(--color-card);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }
    
    .section-title {
      font-size: 1.2rem;
      margin: var(--spacing-md) 0 var(--spacing-sm);
      color: var(--color-text-secondary);
    }
    
    .dashboard {
      padding-bottom: 60px;
    }
    
    .page-title {
      margin-top: 0;
      margin-bottom: var(--spacing-lg);
      font-size: 1.8rem;
    }
    
    .gradient-text {
      background: linear-gradient(to right, var(--color-primary), #E5C867);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .text-success {
      color: #4CAF50;
    }
    
    .text-error {
      color: #F44336;
    }
    
    .text-tertiary {
      color: var(--color-text-tertiary);
    }
    
    .flex {
      display: flex;
    }
    
    .flex-col {
      flex-direction: column;
    }
    
    .items-center {
      align-items: center;
    }
    
    .items-start {
      align-items: flex-start;
    }
    
    .justify-between {
      justify-content: space-between;
    }
    
    .gap-sm {
      gap: var(--spacing-sm);
    }
    
    .gap-md {
      gap: var(--spacing-md);
    }
    
    .grid {
      display: grid;
    }
    
    .grid-cols-1 {
      grid-template-columns: 1fr;
    }
    
    .mb-xs {
      margin-bottom: var(--spacing-xs);
    }
    
    .mb-sm {
      margin-bottom: var(--spacing-sm);
    }
    
    .mb-md {
      margin-bottom: var(--spacing-md);
    }
    
    .mb-lg {
      margin-bottom: var(--spacing-lg);
    }
    
    .mt-xs {
      margin-top: var(--spacing-xs);
    }
    
    .mt-md {
      margin-top: var(--spacing-md);
    }
    
    .ml-1 {
      margin-left: 4px;
    }
    
    .py-md {
      padding-top: var(--spacing-md);
      padding-bottom: var(--spacing-md);
    }
    
    .py-lg {
      padding-top: var(--spacing-lg);
      padding-bottom: var(--spacing-lg);
    }
    
    .text-center {
      text-align: center;
    }
    
    .text-sm {
      font-size: 0.875rem;
    }
    
    .text-lg {
      font-size: 1.125rem;
    }
    
    .text-xl {
      font-size: 1.25rem;
    }
    
    .text-xxl {
      font-size: 2rem;
    }
    
    .font-bold {
      font-weight: 700;
    }
    
    .font-semibold {
      font-weight: 600;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: background-color 0.2s;
    }
    
    .btn-primary {
      background-color: var(--color-primary);
      color: #000;
    }
    
    .btn-primary:hover {
      background-color: var(--color-primary-hover);
    }
    
    .btn-secondary {
      background-color: rgba(203, 163, 40, 0.2);
      color: var(--color-primary);
    }
    
    .btn-secondary:hover {
      background-color: rgba(203, 163, 40, 0.3);
    }
    
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(203, 163, 40, 0.3);
      border-top: 3px solid var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--spacing-md);
    }
    
    .loading-text {
      color: var(--color-text-secondary);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive Utilities */
    @media (min-width: 768px) {
      .md\\:flex-row {
        flex-direction: row;
      }
      
      .md\\:items-center {
        align-items: center;
      }
      
      .md\\:mt-0 {
        margin-top: 0;
      }
      
      .md\\:grid-cols-4 {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    /* Initial loading spinner */
    .initial-loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    
    .loader-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(203, 163, 40, 0.1);
      border-left-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--spacing-md);
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="app">
      <header class="app-header">
        <h1 class="app-title">Realtor Dashboard</h1>
      </header>
      
      <main class="app-content">
        <div class="dashboard">
          <h1 class="page-title">Dashboard</h1>
          
          <!-- Portfolio Value -->
          <div class="card mb-lg">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
              <div>
                <h3 class="text-lg font-semibold mb-xs">Portfolio Value</h3>
                <div class="flex items-center gap-sm">
                  <span class="text-xxl font-bold gradient-text" id="portfolio-value">
                    Loading...
                  </span>
                </div>
                <p class="text-tertiary text-sm mt-xs">Total portfolio value</p>
              </div>
            </div>
          </div>
          
          <!-- Key Statistics -->
          <div class="section-title">Key Statistics</div>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-md mb-lg" id="statistics">
            <div class="card">
              <div class="text-center py-md">
                <p class="text-tertiary">Loading statistics...</p>
              </div>
            </div>
          </div>
          
          <!-- Today's Appointments -->
          <div class="section-title">Today's Appointments</div>
          <div class="card mb-lg" id="appointments">
            <div class="text-center py-md">
              <p class="text-tertiary">Loading appointments...</p>
            </div>
          </div>
          
          <!-- Recent Activities -->
          <div class="section-title">Recent Activities</div>
          <div class="card" id="activities">
            <div class="text-center py-md">
              <p class="text-tertiary">Loading activities...</p>
            </div>
          </div>
        </div>
      </main>
      
      <div class="bottom-nav">
        <a href="/" class="nav-item active">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span class="nav-label">Home</span>
        </a>
        <a href="/properties" class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
          <span class="nav-label">Properties</span>
        </a>
        <a href="/schedule" class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span class="nav-label">Schedule</span>
        </a>
        <a href="/messages" class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <span class="nav-label">Messages</span>
        </a>
        <a href="/profile" class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span class="nav-label">Profile</span>
        </a>
      </div>
    </div>
  </div>

  <script>
    // Fetch dashboard data
    async function fetchDashboardData() {
      try {
        const response = await fetch('/api/dashboard');
        const data = await response.json();
        
        // Update portfolio value
        document.getElementById('portfolio-value').textContent = formatCurrency(data.portfolioValue);
        
        // Update statistics
        const statsContainer = document.getElementById('statistics');
        statsContainer.innerHTML = '';
        
        // Active Listings
        const activeListingsCard = document.createElement('div');
        activeListingsCard.className = 'card';
        activeListingsCard.innerHTML = `
          <div class="flex flex-col items-center">
            <div class="stat-icon mb-sm" style="background-color: rgba(75, 192, 192, 0.2); padding: 12px; border-radius: 50%;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgb(75, 192, 192)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
            </div>
            <span class="text-xl font-bold">${data.statistics.activeListings}</span>
            <span class="text-tertiary text-sm">Active Listings</span>
          </div>
        `;
        statsContainer.appendChild(activeListingsCard);
        
        // Pending Sales
        const pendingSalesCard = document.createElement('div');
        pendingSalesCard.className = 'card';
        pendingSalesCard.innerHTML = `
          <div class="flex flex-col items-center">
            <div class="stat-icon mb-sm" style="background-color: rgba(255, 159, 64, 0.2); padding: 12px; border-radius: 50%;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgb(255, 159, 64)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="8 14 12 10 16 14"></polyline>
              </svg>
            </div>
            <span class="text-xl font-bold">${data.statistics.pendingSales}</span>
            <span class="text-tertiary text-sm">Pending Sales</span>
          </div>
        `;
        statsContainer.appendChild(pendingSalesCard);
        
        // Closed Sales
        const closedSalesCard = document.createElement('div');
        closedSalesCard.className = 'card';
        closedSalesCard.innerHTML = `
          <div class="flex flex-col items-center">
            <div class="stat-icon mb-sm" style="background-color: rgba(75, 192, 75, 0.2); padding: 12px; border-radius: 50%;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgb(75, 192, 75)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
              </svg>
            </div>
            <span class="text-xl font-bold">${data.statistics.closedSales}</span>
            <span class="text-tertiary text-sm">Closed Sales</span>
          </div>
        `;
        statsContainer.appendChild(closedSalesCard);
        
        // New Leads
        const newLeadsCard = document.createElement('div');
        newLeadsCard.className = 'card';
        newLeadsCard.innerHTML = `
          <div class="flex flex-col items-center">
            <div class="stat-icon mb-sm" style="background-color: rgba(54, 162, 235, 0.2); padding: 12px; border-radius: 50%;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgb(54, 162, 235)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
            </div>
            <span class="text-xl font-bold">${data.statistics.newLeads}</span>
            <span class="text-tertiary text-sm">New Leads</span>
          </div>
        `;
        statsContainer.appendChild(newLeadsCard);
        
        // Update appointments
        const appointmentsContainer = document.getElementById('appointments');
        if (data.todayAppointments.length === 0) {
          appointmentsContainer.innerHTML = `
            <div class="text-center py-md">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-tertiary mb-sm mx-auto">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <p class="text-tertiary">No appointments scheduled for today</p>
            </div>
          `;
        } else {
          appointmentsContainer.innerHTML = '<div class="space-y-md"></div>';
          const appointmentsList = appointmentsContainer.querySelector('.space-y-md');
          
          data.todayAppointments.forEach(appointment => {
            const appointmentTime = new Date(appointment.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const appointmentEl = document.createElement('div');
            appointmentEl.className = 'flex items-start gap-md';
            appointmentEl.style.borderBottom = '1px solid var(--color-border)';
            appointmentEl.style.paddingBottom = 'var(--spacing-md)';
            
            appointmentEl.innerHTML = `
              <div class="appointment-time flex flex-col items-center justify-center" style="min-width: 60px;">
                <span class="text-sm font-semibold">${appointmentTime}</span>
              </div>
              
              <div class="flex-1">
                <h4 class="font-semibold mb-xs">${appointment.title}</h4>
                <p class="text-tertiary text-sm mb-xs">${appointment.location}</p>
                ${appointment.notes ? `<p class="text-secondary text-sm">${appointment.notes}</p>` : ''}
              </div>
            `;
            
            appointmentsList.appendChild(appointmentEl);
          });
        }
        
        // Update activities
        const activitiesContainer = document.getElementById('activities');
        if (data.activities.length === 0) {
          activitiesContainer.innerHTML = `
            <div class="text-center py-md">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-tertiary mb-sm mx-auto">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
              <p class="text-tertiary">No recent activities</p>
            </div>
          `;
        } else {
          activitiesContainer.innerHTML = '<div class="space-y-md"></div>';
          const activitiesList = activitiesContainer.querySelector('.space-y-md');
          
          data.activities.forEach((activity, index) => {
            const isLast = index === data.activities.length - 1;
            
            const activityEl = document.createElement('div');
            activityEl.className = 'flex items-start gap-md';
            if (!isLast) {
              activityEl.style.borderBottom = '1px solid var(--color-border)';
              activityEl.style.paddingBottom = 'var(--spacing-md)';
            }
            
            // Get activity icon based on type
            let activityIcon;
            switch (activity.type) {
              case 'listing':
                activityIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgb(75, 192, 192)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>`;
                break;
              case 'lead':
                activityIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgb(54, 162, 235)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>`;
                break;
              case 'property_update':
                activityIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgb(255, 159, 64)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>`;
                break;
              case 'appointment':
                activityIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgb(75, 192, 75)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>`;
                break;
              case 'message':
                activityIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgb(153, 102, 255)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>`;
                break;
              default:
                activityIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--color-text-tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>`;
            }
            
            const createdAt = new Date(activity.createdAt);
            const formattedDate = createdAt.toLocaleString('en-US', { 
              month: 'short', 
              day: 'numeric',
              hour: 'numeric',
              minute: '2-digit'
            });
            
            activityEl.innerHTML = `
              <div class="activity-icon flex flex-col items-center justify-center" style="min-width: 40px;">
                ${activityIcon}
              </div>
              
              <div class="flex-1">
                <h4 class="font-semibold mb-xs">${activity.title}</h4>
                <p class="text-secondary text-sm mb-xs">${activity.description}</p>
                <p class="text-tertiary text-sm">${formattedDate}</p>
              </div>
            `;
            
            activitiesList.appendChild(activityEl);
          });
        }
      } catch (error) {
        console.error('Error fetching dashboard data:', error);
      }
    }
    
    // Format currency
    function formatCurrency(value) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0
      }).format(value);
    }
    
    // Load data when page loads
    document.addEventListener('DOMContentLoaded', fetchDashboardData);
  </script>
</body>
</html>